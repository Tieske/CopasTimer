<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../luadoc.css" type="text/css" />
	<!--meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/-->
</head>

<body>
<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->

<div id="main">

<div id="navigation">


<h1>LuaDoc</h1>
<ul>
	
	<li><a href="../index.html">Index</a></li>
	
</ul>


<!-- Module list -->

<h1>Modules</h1>
<ul>

	<li><strong>copas.timer</strong></li>
	
</ul>



<!-- File list -->






</div><!-- id="navigation" -->

<div id="content">

<h1>Module <code>copas.timer</code></h1>

<p>Copas Timer is a module that adds a timer capability to the Copas scheduler. It provides the same base functions <code>step</code> and <code>loop</code> as Copas except that it will also check for timers expiring. In addition to those standard Copas functions, it also adds an <code>isexiting</code> field that allows for a controlled exit from the loop.<br/>&nbspCopas Timer is free software and uses the same license as Lua.</p>

<p>Copyright &copy; 2011 Thijs Schreijer</p>




<p><b>Release:</b> Version 0.2, Timer module to extend Copas with a timer capability
</p>



<h2>Functions</h2>
<table class="function_list">

	<tr>
	<td class="name" nowrap><a href="#<code>t:</code>arm</code>"><code>t:</code>arm</code></a>&nbsp;(self, interval)</td>
	<td class="summary">Arms a previously created timer </td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#<code>t:</code>cancel</code>"><code>t:</code>cancel</code></a>&nbsp;(self)</td>
	<td class="summary">Cancels a previously armed timer </td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#addcheck">addcheck</a>&nbsp;(handler, interval, errhandler)</td>
	<td class="summary">Creates a timer to repeatedly check the network for changes in its connection state.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#cancelall">cancelall</a>&nbsp;()</td>
	<td class="summary">Cancels all currently armed timers.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#checknetwork">checknetwork</a>&nbsp;(oldState)</td>
	<td class="summary">Checks the network connection of the system and detects changes in connection or IP adress.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#create">create</a>&nbsp;(f_arm, f_expire, f_cancel, recurring, f_error)</td>
	<td class="summary">Creates a new timer.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#delayedexecutioner">delayedexecutioner</a>&nbsp;(delay, func, ...)</td>
	<td class="summary">Calls a function delayed, after the specified amount of time.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#isexiting">isexiting</a>&nbsp;()</td>
	<td class="summary">Indicator of the loop running or exiting (it is a field, not a function!).</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#loop">loop</a>&nbsp;(timeout, precision)</td>
	<td class="summary">Executes an endless loop handling Copas steps and timers.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#step">step</a>&nbsp;(timeout, precision)</td>
	<td class="summary">Executes a single Copas step followed by the execution of the first expired (if any) timer in the timers list.</td>
	</tr>

</table>





<br/>
<br/>



<h2><a name="functions"></a>Functions</h2>
<dl class="function">



<dt><a name="<code>t:</code>arm</code>"></a><strong><code>t:</code>arm</code></strong>&nbsp;(self, interval)</dt>
<dd>
Arms a previously created timer


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>self</em></code>: 
	</li>
	
	<li>
	  <code><em>interval</em></code>: the interval after which the timer expires (in seconds)
	</li>
	
</ul>




<h3>Usage:</h3>
<ul><pre class=example>-- Create a new timer<br/>local t = copas.timer.create(nil, function () print("hello world") end, nil, false)<br/>t:arm(5)              -- arm it at 5 seconds<br/>t:cancel()            -- cancel it again</pre></ul>





</dd>




<dt><a name="<code>t:</code>cancel</code>"></a><strong><code>t:</code>cancel</code></strong>&nbsp;(self)</dt>
<dd>
Cancels a previously armed timer


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>self</em></code>: 
	</li>
	
</ul>




<h3>Usage:</h3>
<ul><pre class=example>-- Create a new timer<br/>local t = copas.timer.create(nil, function () print("hello world") end, nil, false)<br/>t:arm(5)              -- arm it at 5 seconds<br/>t:cancel()            -- cancel it again</pre></ul>





</dd>




<dt><a name="addcheck"></a><strong>addcheck</strong>&nbsp;(handler, interval, errhandler)</dt>
<dd>
Creates a timer to repeatedly check the network for changes in its connection state. It basically wraps the <code>checknetwork</code> function. The first check will run when the timer gets armed.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>handler</em></code>: callback function to be called when the network state changes. 2 arguments; <code>newState</code>, <codce>oldState</code>.
	</li>
	
	<li>
	  <code><em>interval</em></code>: optional interval for checking in seconds. If provided the timer will be armed immediately, otherwise it has to be armed afterwards.
	</li>
	
	<li>
	  <code><em>errhandler</em></code>: optional errorhandler to be used for the <code>handler</code> callback function
	</li>
	
</ul>






<h3>Return value:</h3>
<ul>timer</ul>



</dd>




<dt><a name="cancelall"></a><strong>cancelall</strong>&nbsp;()</dt>
<dd>
Cancels all currently armed timers. Call this method after exiting the loop, to make sure all timers are properly cancelled and their cancel callback methods have been executed.









</dd>




<dt><a name="checknetwork"></a><strong>checknetwork</strong>&nbsp;(oldState)</dt>
<dd>
Checks the network connection of the system and detects changes in connection or IP adress. Call repeatedly to check status for changes. With every call include the previous results to compare with.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>oldState</em></code>: (table) previous result to compare with, or <code>nil</code> if not called before
	</li>
	
</ul>




<h3>Usage:</h3>
<ul><pre class=example>function test()<br/>&nbsp&nbsp&nbsp&nbspprint ("TEST: entering endless check loop, change connection settings and watch the changes come in...")<br/>&nbsp&nbsp&nbsp&nbsprequire ("base")	-- from stdlib to pretty print the table<br/>&nbsp&nbsp&nbsp&nbsplocal change, data<br/>&nbsp&nbsp&nbsp&nbspwhile true do<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchange, data = copas.timer.checknetwork(data)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif change then<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspprint (prettytostring(data))<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend<br/>&nbsp&nbsp&nbsp&nbspend<br/>end</pre></ul>



<h3>Return values:</h3>
<ol>
	
	<li>changed (boolean) same as <code>newstate.changed</code> (see below).</li>
	
	<li>newState (table) same as regular info from <code>socket.dns</code> calls, but extended with; <ul><li><code>localhostname </code>= (string) name of localhost (only field that can be set, defaults to <code>'localhost'</code>)</li> <li><code>localhostip   </code>= (string) ip address resolved for <code>localhostname</code></li> <li><code>connected     </code>= (string) either <code>'yes'</code>, <code>'no'</code>, or <code>'loopback'</code> (loopback means connected to localhost, no external connection)</li> <li><code>changed       </code>= (boolean) <code>true</code> if <code>oldstate</code> is different on either; <code>name</code>, <code>connected</code>, or <code>ip[1]</code> properties</li></ul></li>
	
</ol>



</dd>




<dt><a name="create"></a><strong>create</strong>&nbsp;(f_arm, f_expire, f_cancel, recurring, f_error)</dt>
<dd>
Creates a new timer. After creating call the <code>arm</code> method of the new timer to actually schedule it.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>f_arm</em></code>: callback function to execute when the timer is armed
	</li>
	
	<li>
	  <code><em>f_expire</em></code>: callback function to execute when the timer expires
	</li>
	
	<li>
	  <code><em>f_cancel</em></code>: callback function to execute when the timer is cancelled
	</li>
	
	<li>
	  <code><em>recurring</em></code>: (boolean) should the timer automatically be re-armed with the same interval after it expired
	</li>
	
	<li>
	  <code><em>f_error</em></code>: callback function to execute when any of the other callbacks generates an error
	</li>
	
</ul>




<h3>Usage:</h3>
<ul><pre class=example>-- Create a new timer<br/>local t = copas.timer.create(nil, function () print("hello world") end, nil, false, nil)<br/>&nbsp;<br/>-- Create timer and arm it immediately, to be run in 5 seconds<br/>copas.timer.create(nil, function () print("hello world") end, nil, false, nil):arm(5)<br/>&nbsp;<br/>-- Create timer and arm it immediately, to be run now (function f is provide twice!) and again every 5 seconds<br/>local f = function () print("hello world") end<br/>copas.timer.create(f, f, nil, true, nil):arm(5)</pre></ul>





</dd>




<dt><a name="delayedexecutioner"></a><strong>delayedexecutioner</strong>&nbsp;(delay, func, ...)</dt>
<dd>
Calls a function delayed, after the specified amount of time.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>delay</em></code>: delay in seconds before calling the function
	</li>
	
	<li>
	  <code><em>func</em></code>: function to call
	</li>
	
	<li>
	  <code><em>...</em></code>: any arguments to be passed to the function
	</li>
	
</ul>








</dd>




<dt><a name="isexiting"></a><strong>isexiting</strong>&nbsp;()</dt>
<dd>
Indicator of the loop running or exiting (it is a field, not a function!). Possible values; <ul> <li><code>nil</code>: the loop is not running, </li> <li><code>false</code>: the loop is running, or </li> <li><code>true</code>: the loop is scheduled to stop after the current iteration.</li></ul>





<h3>Usage:</h3>
<ul><pre class=example>if copas.timer.isexiting ~= nil then<br/>&nbsp&nbsp&nbsp&nbsp-- loop is currently running, make it exit after the next iteration<br/>&nbsp&nbsp&nbsp&nbspcopas.timer.isexiting = true<br/>end</pre></ul>





</dd>




<dt><a name="loop"></a><strong>loop</strong>&nbsp;(timeout, precision)</dt>
<dd>
Executes an endless loop handling Copas steps and timers. The loop can be terminated by setting <code>isexiting</code> to true. When exiting the loop, consider call <code>cancelall()</code> to make sure all armed timers get properly cancelled and their <code>cancel</code> callbacks get called properly.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>timeout</em></code>: time out (in seconds) to be used. The timer list will be checked at least every <code>timeout</code> period for expired timers. The actual interval will be between <code>0.001</code> and <code>timeout</code> based on the next timers expire time. If not provided, it defaults to 5 seconds.
	</li>
	
	<li>
	  <code><em>precision</em></code>: the precision of the timer (in seconds). Whenever the timer list is checked for expired timers, a timer is considered expired when the exact expire time is in the past or up to <code>precision</code> seconds in the future. It defaults to 0.02 if not provided.
	</li>
	
</ul>








</dd>




<dt><a name="step"></a><strong>step</strong>&nbsp;(timeout, precision)</dt>
<dd>
Executes a single Copas step followed by the execution of the first expired (if any) timer in the timers list.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>timeout</em></code>: timeout value (in seconds) to pass to the Copas step handler
	</li>
	
	<li>
	  <code><em>precision</em></code>: see parameter <code>precision</code> at function <code>loop()</code>.
	</li>
	
</ul>






<h3>Return value:</h3>
<ul>time in seconds until the next timer in the list expires, or <code>nil</code> if there is none</ul>



</dd>


</dl>






</div> <!-- id="content" -->

</div> <!-- id="main" -->

<div id="about">
	<p><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" /></a></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->	
</body>
</html>
